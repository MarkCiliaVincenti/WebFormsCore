!function(){"use strict";var e,t=11;function n(e,n){var r,o,a,i,c=n.attributes;if(n.nodeType!==t&&e.nodeType!==t){for(var s=c.length-1;s>=0;s--)o=(r=c[s]).name,a=r.namespaceURI,i=r.value,a?(o=r.localName||o,e.getAttributeNS(a,o)!==i&&("xmlns"===r.prefix&&(o=r.name),e.setAttributeNS(a,o,i))):e.getAttribute(o)!==i&&e.setAttribute(o,i);for(var d=e.attributes,u=d.length-1;u>=0;u--)o=(r=d[u]).name,(a=r.namespaceURI)?(o=r.localName||o,n.hasAttributeNS(a,o)||e.removeAttributeNS(a,o)):n.hasAttribute(o)||e.removeAttribute(o)}}var r="http://www.w3.org/1999/xhtml",o="undefined"==typeof document?void 0:document,a=!!o&&"content"in o.createElement("template"),i=!!o&&o.createRange&&"createContextualFragment"in o.createRange();function c(t){return t=t.trim(),a?function(e){var t=o.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(t):i?function(t){return e||(e=o.createRange()).selectNode(o.body),e.createContextualFragment(t).childNodes[0]}(t):function(e){var t=o.createElement("body");return t.innerHTML=e,t.childNodes[0]}(t)}function s(e,t){var n,r,o=e.nodeName,a=t.nodeName;return o===a||(n=o.charCodeAt(0),r=a.charCodeAt(0),n<=90&&r>=97?o===a.toUpperCase():r<=90&&n>=97&&a===o.toUpperCase())}function d(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var u={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}d(e,t,"selected")},INPUT:function(e,t){d(e,t,"checked"),d(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,a=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){o=a;break}a++}!(i=i.nextSibling)&&n&&(i=n.nextSibling,n=null)}e.selectedIndex=o}}};function l(){}function f(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const m=new Error("request for lock canceled");var h=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};class v{constructor(e,t=m){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()}))}runExclusive(e,t=1){return h(this,void 0,void 0,(function*(){const[n,r]=yield this.acquire(t);try{return yield e(n)}finally{r()}}))}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()}))}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach((e=>e.forEach((e=>e.reject(this._cancelError))))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){const n=null===(e=this._weightedQueues[t-1])||void 0===e?void 0:e.shift();if(!n)continue;const r=this._value,o=t;this._value-=t,t=this._value+1,n.resolve([r,this._newReleaser(o)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach((e=>e())),this._weightedWaiters[e-1]=[])}}var p=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))};const w=function(e){return function(t,n,a){if(a||(a={}),"string"==typeof n)if("#document"===t.nodeName||"HTML"===t.nodeName||"BODY"===t.nodeName){var i=n;(n=o.createElement("html")).innerHTML=i}else n=c(n);else 11===n.nodeType&&(n=n.firstElementChild);var d=a.getNodeKey||f,m=a.onBeforeNodeAdded||l,h=a.onNodeAdded||l,v=a.onBeforeElUpdated||l,p=a.onElUpdated||l,w=a.onBeforeNodeDiscarded||l,b=a.onNodeDiscarded||l,g=a.onBeforeElChildrenUpdated||l,E=a.skipFromChildren||l,y=a.addChild||function(e,t){return e.appendChild(t)},N=!0===a.childrenOnly,A=Object.create(null),T=[];function C(e){T.push(e)}function S(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var r=void 0;t&&(r=d(n))?C(r):(b(n),n.firstChild&&S(n,t)),n=n.nextSibling}}function _(e,t,n){!1!==w(e)&&(t&&t.removeChild(e),b(e),S(e,n))}function U(e){h(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=d(t);if(r){var o=A[r];o&&s(t,o)?(t.parentNode.replaceChild(o,t),k(o,t)):U(t)}else U(t);t=n}}function k(t,n,r){var a=d(n);if(a&&delete A[a],!r){if(!1===v(t,n))return;if(e(t,n),p(t),!1===g(t,n))return}"TEXTAREA"!==t.nodeName?function(e,t){var n,r,a,i,c,l=E(e),f=t.firstChild,h=e.firstChild;e:for(;f;){for(i=f.nextSibling,n=d(f);!l&&h;){if(a=h.nextSibling,f.isSameNode&&f.isSameNode(h)){f=i,h=a;continue e}r=d(h);var v=h.nodeType,p=void 0;if(v===f.nodeType&&(1===v?(n?n!==r&&((c=A[n])?a===c?p=!1:(e.insertBefore(c,h),r?C(r):_(h,e,!0),h=c):p=!1):r&&(p=!1),(p=!1!==p&&s(h,f))&&k(h,f)):3!==v&&8!=v||(p=!0,h.nodeValue!==f.nodeValue&&(h.nodeValue=f.nodeValue))),p){f=i,h=a;continue e}r?C(r):_(h,e,!0),h=a}if(n&&(c=A[n])&&s(c,f))l||y(e,c),k(c,f);else{var w=m(f);!1!==w&&(w&&(f=w),f.actualize&&(f=f.actualize(e.ownerDocument||o)),y(e,f),U(f))}f=i,h=a}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=d(t))?C(n):_(t,e,!0),t=r}}(e,h,r);var b=u[e.nodeName];b&&b(e,t)}(t,n):u.TEXTAREA(t,n)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var r=d(n);r&&(A[r]=n),e(n),n=n.nextSibling}}(t);var L,x,D=t,R=D.nodeType,O=n.nodeType;if(!N)if(1===R)1===O?s(t,n)||(b(t),D=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(t,(L=n.nodeName,(x=n.namespaceURI)&&x!==r?o.createElementNS(x,L):o.createElement(L)))):D=n;else if(3===R||8===R){if(O===R)return D.nodeValue!==n.nodeValue&&(D.nodeValue=n.nodeValue),D;D=n}if(D===n)b(t);else{if(n.isSameNode&&n.isSameNode(D))return;if(k(D,n,N),T)for(var q=0,P=T.length;q<P;q++){var I=A[T[q]];I&&_(I,I.parentNode,!1)}}return!N&&D!==t&&t.parentNode&&(D.actualize&&(D=D.actualize(t.ownerDocument||o)),t.parentNode.replaceChild(D,t)),D}}(n),b=new class{constructor(e){this._semaphore=new v(1,e)}acquire(){return p(this,void 0,void 0,(function*(){const[,e]=yield this._semaphore.acquire();return e}))}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};class g{constructor(e,t){this.element=e,this.formData=t}querySelector(e){if(this.element){const t=this.element.querySelector(e);if(t)return t}return document.body.closest(":not([data-wfc-form]) "+e)}querySelectorAll(e){const t=document.body.querySelectorAll(":not([data-wfc-form]) "+e);return this.element?[...this.element.querySelectorAll(e),...t]:Array.from(t)}addInputs(e){const t=this.querySelectorAll(e);for(let e=0;e<t.length;e++){y(t[e],this.formData)}}}function E(e,t,n){const r=A(e),o=T(e);return o?function(e,t,n){const r=e.webSocket;if(!r)throw new Error("No WebSocket connection");const o={t:t,a:n};r.send(JSON.stringify(o))}(o,t,n):S(e,r,t,n)}function y(e,t){"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):t.append(e.name,e.value)}function N(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}function A(e){return e.closest("[data-wfc-form]")}function T(e){return e.closest("[data-wfc-stream]")}function C(e,t,n,r){const o=[];for(const e of t.querySelectorAll("input, select, textarea"))e.closest("[data-wfc-ignore]")||o.push(e);document.dispatchEvent(new CustomEvent("wfc:addInputs",{detail:{elements:o}}));for(let t=0;t<o.length;t++){const a=o[t];a.hasAttribute("data-wfc-ignore")||"button"===a.type||"submit"===a.type||"reset"===a.type||(a.closest("[data-wfc-ignore]")||!n&&A(a)||T(a)||(r||"file"!==a.type)&&y(a,e))}}async function S(e,t,n,r){var o;const a=e.closest("[data-wfc-base]");let i;i=t&&"self"===t.getAttribute("data-wfc-form")?t:a||document.body;const c=null!==(o=null==a?void 0:a.getAttribute("data-wfc-base"))&&void 0!==o?o:location.toString(),s=function(e,t,n,r=!0){let o;return e?"FORM"===e.tagName&&r?o=new FormData(e):(o=new FormData,C(o,e,!0,r)):o=new FormData,C(o,document.body,!1,r),t&&o.append("wfcTarget",t),n&&o.append("wfcArgument",n),o}(t,n,r),d=new g(t,s),u=await b.acquire();try{document.dispatchEvent(new CustomEvent("wfc:beforeSubmit",{detail:{target:i,container:d,eventTarget:n}}));const r={method:"POST",redirect:"error",credentials:"include",headers:{"X-IsPostback":"true"}};r.body=function(e){const t=document.body.querySelectorAll('input[type="file"]');for(let e=0;e<t.length;e++)if(t[e].files.length>0)return!0;return!1}(document.body)?s:new URLSearchParams(s);const o=await fetch(c,r);if(!o.ok)throw document.dispatchEvent(new CustomEvent("wfc:submitError",{detail:{form:t,eventTarget:n,response:o}})),new Error(o.statusText);const u=o.headers.get("x-redirect-to");if(u)return void window.location.assign(u);const l=o.headers.get("content-disposition");if(204===o.status);else if(o.ok&&l&&-1!==l.indexOf("attachment"))!async function(e,t,n){var r;document.dispatchEvent(new CustomEvent("wfc:beforeFileDownload",{detail:{element:e,response:t}}));try{const o=t.headers.get("content-encoding"),a=t.headers.get(o?"x-file-size":"content-length");if(a){const n=parseInt(a,10);let r=0;const o=t.body.getReader();let i=function(n,r){const o=Math.round(n/r*100);document.dispatchEvent(new CustomEvent("wfc:progressFileDownload",{detail:{element:e,response:t,loaded:n,total:r,percent:o}}))};t=new Response(new ReadableStream({start(e){function t(){o.read().then((({done:o,value:a})=>{if(o)return 0===n&&i(r,n),void e.close();r+=a.byteLength,i(r,n),e.enqueue(a),t()})).catch((t=>{console.error(t),e.error(t)}))}t()}}))}const i=n.match(/filename=(?:"([^"]+)"|([^;]+))/),c=await t.blob(),s=URL.createObjectURL(c),d=document.createElement("a");d.href=s,d.style.display="none",d.download=i?null!==(r=i[1])&&void 0!==r?r:i[2]:"download",document.body.appendChild(d),d.click(),setTimeout((()=>{document.body.removeChild(d),URL.revokeObjectURL(s)}),0)}finally{document.dispatchEvent(new CustomEvent("wfc:afterFileDownload",{detail:{element:e,response:t}}))}}(e,o,l);else{const e=await o.text(),n=_(t),r=(new DOMParser).parseFromString(e,"text/html");t&&"self"===t.getAttribute("data-wfc-form")?w(t,r.querySelector("[data-wfc-form]"),n):a?w(a,r.querySelector("[data-wfc-base]"),n):(w(document.head,r.querySelector("head"),n),w(document.body,r.querySelector("body"),n))}}finally{u(),document.dispatchEvent(new CustomEvent("wfc:afterSubmit",{detail:{target:i,container:d,form:t,eventTarget:n}}))}}function _(e){return{onNodeAdded(t){document.dispatchEvent(new CustomEvent("wfc:addNode",{detail:{node:t,form:e}})),t.nodeType===Node.ELEMENT_NODE&&document.dispatchEvent(new CustomEvent("wfc:addElement",{detail:{element:t,form:e}}))},onBeforeElUpdated:function(t,r){return!!t.dispatchEvent(new CustomEvent("wfc:beforeUpdateNode",{cancelable:!0,bubbles:!0,detail:{node:t,source:r,form:e}}))&&(!(t.nodeType===Node.ELEMENT_NODE&&!t.dispatchEvent(new CustomEvent("wfc:beforeUpdateElement",{cancelable:!0,bubbles:!0,detail:{element:t,source:r,form:e}})))&&(!t.hasAttribute("data-wfc-ignore")&&!r.hasAttribute("data-wfc-ignore")&&("INPUT"===t.tagName&&"hidden"!==t.type?(n(t,r),N(t,r,"checked"),N(t,r,"disabled"),r.hasAttribute("value")&&(t.value=r.value),!1):void 0)))},onElUpdated(t){t.nodeType===Node.ELEMENT_NODE&&t.dispatchEvent(new CustomEvent("wfc:updateElement",{bubbles:!0,detail:{element:t,form:e}}))},onBeforeNodeDiscarded(t){var n,r;return!("SCRIPT"===t.tagName||"STYLE"===t.tagName||"LINK"===t.tagName&&t.hasAttribute("rel")&&"stylesheet"===t.getAttribute("rel"))&&(!(t instanceof Element&&t.hasAttribute("data-wfc-form"))&&(("DIV"!==t.tagName||!t.hasAttribute("data-wfc-owner")||(null!==(n=t.getAttribute("data-wfc-owner"))&&void 0!==n?n:"")===(null!==(r=null==e?void 0:e.id)&&void 0!==r?r:""))&&(!!t.dispatchEvent(new CustomEvent("wfc:discardNode",{bubbles:!0,cancelable:!0,detail:{node:t,form:e}}))&&(!(t.nodeType===Node.ELEMENT_NODE&&!t.dispatchEvent(new CustomEvent("wfc:discardElement",{bubbles:!0,cancelable:!0,detail:{element:t,form:e}})))&&void 0))))}}}const U=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=async function(){this.hasAttribute("data-wfc-form")?await S(this,this):U.call(this)},document.addEventListener("submit",(async function(e){e.target instanceof Element&&e.target.hasAttribute("data-wfc-form")&&(e.preventDefault(),await S(e.target,e.target))})),document.addEventListener("click",(async function(e){var t;if(!(e.target instanceof Element))return;const n=null===(t=e.target)||void 0===t?void 0:t.closest("[data-wfc-postback]");if(!n)return;e.preventDefault();if("true"===n.getAttribute("data-wfc-disabled"))return;const r=n.getAttribute("data-wfc-postback");E(e.target,r)})),document.addEventListener("keypress",(async function(e){if("Enter"!==e.key&&13!==e.keyCode&&13!==e.which)return;if(!(e.target instanceof Element)||"INPUT"!==e.target.tagName)return;const t=e.target.getAttribute("type");if("button"===t||"submit"===t||"reset"===t)return;const n=e.target.getAttribute("name");e.preventDefault(),await E(e.target,n,"ENTER")}));const k={};function L(e,t=1e3,n="CHANGE"){var r,o;const a=null!==(r=T(e))&&void 0!==r?r:A(e),i=e.getAttribute("name"),c=(null!==(o=null==a?void 0:a.id)&&void 0!==o?o:"")+i+n;k[c]&&clearTimeout(k[c]),k[c]=setTimeout((async()=>{delete k[c],await E(e,i,n)}),t)}document.addEventListener("input",(function(e){if(!(e.target instanceof Element&&"INPUT"===e.target.tagName&&e.target.hasAttribute("data-wfc-autopostback")))return;const t=e.target.getAttribute("type");"button"!==t&&"submit"!==t&&"reset"!==t&&L(e.target)})),document.addEventListener("change",(async function(e){var t,n;if(e.target instanceof Element&&e.target.hasAttribute("data-wfc-autopostback")){const r=e.target.getAttribute("name"),o=null!==(t=T(e.target))&&void 0!==t?t:A(e.target),a=(null!==(n=null==o?void 0:o.id)&&void 0!==n?n:"")+r;k[a]&&clearTimeout(k[a]),setTimeout((()=>E(e.target,r,"CHANGE")),10)}}));const x={postBackChange:L,postBack:function(e,t){const n=e.getAttribute("name");return E(e,n,t)},bind:function(e,t){var n,r;const o=null!==(n=t.init)&&void 0!==n?n:function(){},a=null!==(r=t.update)&&void 0!==r?r:function(){},i=t.submit,c=t.destroy;for(const t of document.querySelectorAll(e))o(t),a(t,t);document.addEventListener("wfc:addElement",(function(t){const{element:n}=t.detail;n.matches(e)&&(o(n),a(n,n))})),document.addEventListener("wfc:beforeUpdateElement",(function(t){const{element:n,source:r}=t.detail;n.matches(e)&&a(n,r)&&t.preventDefault()})),i&&document.addEventListener("wfc:beforeSubmit",(function(t){const{container:n}=t.detail;for(const t of n.querySelectorAll(e))i(t,n.formData)})),c&&document.addEventListener("wfc:discardElement",(function(t){const{element:n}=t.detail;n.matches(e)&&(c(n),t.preventDefault())}))}};x.bind("[data-wfc-stream]",{init:function(e){const t=e.id,n=e.closest("[data-wfc-base]"),r=n?new URL(n.getAttribute("data-wfc-base")):location;let o=r.search;o?o+="&":o="?",o+="__panel="+t;const a=new WebSocket(("https:"===r.protocol?"wss://":"ws://")+r.host+r.pathname+o);e.webSocket=a,e.isUpdating=!1,a.addEventListener("message",(function(n){const r=(new DOMParser).parseFromString(`<!DOCTYPE html><html><body>${n.data}</body></html>`,"text/html");e.isUpdating=!0,w(e,r.getElementById(t),_()),e.isUpdating=!1}))},update:function(e,t){if(!e.isUpdating)return!0},destroy:function(e){const t=e.webSocket;t&&t.close()}}),window.WebFormsCore=x}();
