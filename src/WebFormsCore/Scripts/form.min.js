!function(){"use strict";var e,t=11;var n="http://www.w3.org/1999/xhtml",r="undefined"==typeof document?void 0:document,i=!!r&&"content"in r.createElement("template"),a=!!r&&r.createRange&&"createContextualFragment"in r.createRange();function o(t){return t=t.trim(),i?function(e){var t=r.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(t):a?function(t){return e||(e=r.createRange()).selectNode(r.body),e.createContextualFragment(t).childNodes[0]}(t):function(e){var t=r.createElement("body");return t.innerHTML=e,t.childNodes[0]}(t)}function s(e,t){var n,r,i=e.nodeName,a=t.nodeName;return i===a||(n=i.charCodeAt(0),r=a.charCodeAt(0),n<=90&&r>=97?i===a.toUpperCase():r<=90&&n>=97&&a===i.toUpperCase())}function u(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var c={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}u(e,t,"selected")},INPUT:function(e,t){u(e,t,"checked"),u(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var i=r.nodeValue;if(i==n||!n&&i==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,i=-1,a=0,o=e.firstChild;o;)if("OPTGROUP"===(r=o.nodeName&&o.nodeName.toUpperCase()))o=(n=o).firstChild;else{if("OPTION"===r){if(o.hasAttribute("selected")){i=a;break}a++}!(o=o.nextSibling)&&n&&(o=n.nextSibling,n=null)}e.selectedIndex=i}}},d=1,l=11,f=3,h=8;function m(){}function v(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const p=new Error("request for lock canceled");var g=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))};class w{constructor(e,t=p){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()}))}runExclusive(e,t=1){return g(this,void 0,void 0,(function*(){const[n,r]=yield this.acquire(t);try{return yield e(n)}finally{r()}}))}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()}))}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach((e=>e.forEach((e=>e.reject(this._cancelError))))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){const n=null===(e=this._weightedQueues[t-1])||void 0===e?void 0:e.shift();if(!n)continue;const r=this._value,i=t;this._value-=t,t=this._value+1,n.resolve([r,this._newReleaser(i)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach((e=>e())),this._weightedWaiters[e-1]=[])}}var b=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))};const E=function(e){return function(t,i,a){if(a||(a={}),"string"==typeof i)if("#document"===t.nodeName||"HTML"===t.nodeName||"BODY"===t.nodeName){var u=i;(i=r.createElement("html")).innerHTML=u}else i=o(i);else i.nodeType===l&&(i=i.firstElementChild);var p=a.getNodeKey||v,g=a.onBeforeNodeAdded||m,w=a.onNodeAdded||m,b=a.onBeforeElUpdated||m,E=a.onElUpdated||m,y=a.onBeforeNodeDiscarded||m,N=a.onNodeDiscarded||m,T=a.onBeforeElChildrenUpdated||m,A=a.skipFromChildren||m,_=a.addChild||function(e,t){return e.appendChild(t)},C=!0===a.childrenOnly,S=Object.create(null),x=[];function k(e){x.push(e)}function U(e,t){if(e.nodeType===d)for(var n=e.firstChild;n;){var r=void 0;t&&(r=p(n))?k(r):(N(n),n.firstChild&&U(n,t)),n=n.nextSibling}}function P(e,t,n){!1!==y(e)&&(t&&t.removeChild(e),N(e),U(e,n))}function R(e){w(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=p(t);if(r){var i=S[r];i&&s(t,i)?(t.parentNode.replaceChild(i,t),L(i,t)):R(t)}else R(t);t=n}}function L(t,n,i){var a=p(n);if(a&&delete S[a],!i){if(!1===b(t,n))return;if(e(t,n),E(t),!1===T(t,n))return}"TEXTAREA"!==t.nodeName?function(e,t){var n,i,a,o,u,l=A(e),m=t.firstChild,v=e.firstChild;e:for(;m;){for(o=m.nextSibling,n=p(m);!l&&v;){if(a=v.nextSibling,m.isSameNode&&m.isSameNode(v)){m=o,v=a;continue e}i=p(v);var w=v.nodeType,b=void 0;if(w===m.nodeType&&(w===d?(n?n!==i&&((u=S[n])?a===u?b=!1:(e.insertBefore(u,v),i?k(i):P(v,e,!0),v=u):b=!1):i&&(b=!1),(b=!1!==b&&s(v,m))&&L(v,m)):w!==f&&w!=h||(b=!0,v.nodeValue!==m.nodeValue&&(v.nodeValue=m.nodeValue))),b){m=o,v=a;continue e}i?k(i):P(v,e,!0),v=a}if(n&&(u=S[n])&&s(u,m))l||_(e,u),L(u,m);else{var E=g(m);!1!==E&&(E&&(m=E),m.actualize&&(m=m.actualize(e.ownerDocument||r)),_(e,m),R(m))}m=o,v=a}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=p(t))?k(n):P(t,e,!0),t=r}}(e,v,i);var y=c[e.nodeName];y&&y(e,t)}(t,n):c.TEXTAREA(t,n)}!function e(t){if(t.nodeType===d||t.nodeType===l)for(var n=t.firstChild;n;){var r=p(n);r&&(S[r]=n),e(n),n=n.nextSibling}}(t);var O,V,D=t,I=D.nodeType,F=i.nodeType;if(!C)if(I===d)F===d?s(t,i)||(N(t),D=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(t,(O=i.nodeName,(V=i.namespaceURI)&&V!==n?r.createElementNS(V,O):r.createElement(O)))):D=i;else if(I===f||I===h){if(F===I)return D.nodeValue!==i.nodeValue&&(D.nodeValue=i.nodeValue),D;D=i}if(D===i)N(t);else{if(i.isSameNode&&i.isSameNode(D))return;if(L(D,i,C),x)for(var q=0,B=x.length;q<B;q++){var M=S[x[q]];M&&P(M,M.parentNode,!1)}}return!C&&D!==t&&t.parentNode&&(D.actualize&&(D=D.actualize(t.ownerDocument||r)),t.parentNode.replaceChild(D,t)),D}}((function(e,n){var r,i,a,o,s=n.attributes;if(n.nodeType!==t&&e.nodeType!==t){for(var u=s.length-1;u>=0;u--)i=(r=s[u]).name,a=r.namespaceURI,o=r.value,a?(i=r.localName||i,e.getAttributeNS(a,i)!==o&&("xmlns"===r.prefix&&(i=r.name),e.setAttributeNS(a,i,o))):e.getAttribute(i)!==o&&e.setAttribute(i,o);for(var c=e.attributes,d=c.length-1;d>=0;d--)i=(r=c[d]).name,(a=r.namespaceURI)?(i=r.localName||i,n.hasAttributeNS(a,i)||e.removeAttributeNS(a,i)):n.hasAttribute(i)||e.removeAttribute(i)}})),y=new class{constructor(e){this._semaphore=new w(1,e)}acquire(){return b(this,void 0,void 0,(function*(){const[,e]=yield this._semaphore.acquire();return e}))}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};async function N(e,t,n){const r=await y.acquire();try{const r=document.getElementById("pagestate"),i=location.pathname+location.search,a=e?new FormData(e):new FormData;if(r){const e=document.body.querySelectorAll("input, select, textarea");for(let t=0;t<e.length;t++){const n=e[t];if(n.hasAttribute("data-wfc-ignore")||"button"===n.type||"submit"===n.type||"reset"===n.type)continue;n.closest("form[data-wfc-form]")||("checkbox"===n.type||"radio"===n.type?n.checked&&a.append(n.name,n.value):a.append(n.name,n.value))}a.append("__PAGESTATE",r.value)}t&&a.append("__EVENTTARGET",t),n&&a.append("__EVENTARGUMENT",n),document.dispatchEvent(new CustomEvent("wfc:beforeSubmit",{detail:{form:e,eventTarget:t,formData:a}}));const o={method:"POST"};if(document.body.querySelector('input[type="file"]:not([data-wfc-ignore])'))o.body=a;else{const e={};a.forEach((function(t,n){e[n]=t})),o.body=JSON.stringify(e),o.headers={"Content-Type":"application/json"}}const s=await fetch(i,o);if(!s.ok)throw document.dispatchEvent(new CustomEvent("wfc:submitError",{detail:{form:e,eventTarget:t,response:s}})),new Error(s.statusText);const u=await s.text(),c=[],d={onNodeAdded(n){c.push(n),document.dispatchEvent(new CustomEvent("wfc:addNode",{detail:{node:n,form:e,eventTarget:t}}))},onBeforeElUpdated:function(e,t){if(e===document.activeElement&&"INPUT"===e.tagName)return!1},onBeforeNodeDiscarded(n){var r,i;if("SCRIPT"===n.tagName)return!1;if("FORM"===n.tagName&&n.hasAttribute("data-wfc-form"))return!1;if("DIV"===n.tagName&&n.hasAttribute("data-wfc-owner")&&(null!==(r=n.getAttribute("data-wfc-owner"))&&void 0!==r?r:"")!==(null!==(i=null==e?void 0:e.id)&&void 0!==i?i:""))return!1;return!!document.dispatchEvent(new CustomEvent("wfc:discardNode",{detail:{node:n,form:e,eventTarget:t},cancelable:!0}))&&void 0}},l=(new DOMParser).parseFromString(u,"text/html");E(document.head,l.querySelector("head"),d),E(document.body,l.querySelector("body"),d),document.dispatchEvent(new CustomEvent("wfc:afterSubmit",{detail:{form:e,eventTarget:t,newElements:c}}))}finally{r()}}const T=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=async function(){this.hasAttribute("data-wfc-form")?await N(this):T.call(this)},document.addEventListener("submit",(async function(e){e.target instanceof Element&&e.target.hasAttribute("data-wfc-form")&&(e.preventDefault(),await N(e.target))})),document.addEventListener("click",(async function(e){var t,n;if(!(e.target instanceof Element))return;const r=null===(n=null===(t=e.target)||void 0===t?void 0:t.closest("[data-wfc-postback]"))||void 0===n?void 0:n.getAttribute("data-wfc-postback");if(!r)return;const i=e.target.closest("form[data-wfc-form]");e.preventDefault(),await N(i,r)})),document.addEventListener("keypress",(async function(e){if("Enter"!==e.key&&13!==e.keyCode&&13!==e.which)return;if(!(e.target instanceof Element)||"INPUT"!==e.target.tagName)return;const t=e.target.getAttribute("type");if("button"===t||"submit"===t||"reset"===t)return;const n=e.target.closest("form[data-wfc-form]"),r=e.target.getAttribute("name");e.preventDefault(),await N(n,r,"ENTER")}));const A={};document.addEventListener("input",(function(e){var t;if(!(e.target instanceof Element&&"INPUT"===e.target.tagName&&e.target.hasAttribute("data-wfc-autopostback")))return;const n=e.target.getAttribute("type");if("button"===n||"submit"===n||"reset"===n)return;const r=e.target.closest("form[data-wfc-form]"),i=e.target.getAttribute("name"),a=(null!==(t=null==r?void 0:r.id)&&void 0!==t?t:"")+i;A[a]&&clearTimeout(A[a]),A[a]=setTimeout((async()=>{delete A[a],await N(r,i,"CHANGE")}),1e3)})),document.addEventListener("change",(async function(e){var t;if(e.target instanceof Element&&e.target.hasAttribute("data-wfc-autopostback")){const n=e.target.getAttribute("name"),r=e.target.closest("form[data-wfc-form]"),i=(null!==(t=null==r?void 0:r.id)&&void 0!==t?t:"")+n;A[i]&&clearTimeout(A[i]),setTimeout((()=>N(r,n,"CHANGE")),10)}}))}();
